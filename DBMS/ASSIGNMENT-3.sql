USE CRICKET_TOURNAMENT;

/*
1. PERSON - PK(DRIVER ID)
2. CAR - PK(REGISTER NUMBER)
3. ACCIDENT - PK(REPORT NUMBER)
4. OWNS - FK(DRIVER_ID, REGISTRATION NUMBER) & BOTH ARE COMPOSIT KEY
5. PARTICIPATED - FK( DRIVER_ID, REGISTRATION NUMBER, REPORT_NUMBER), & ALL ARE COMPOSIT KEY 
*/

/* PERSON TABLE */
CREATE TABLE PERSON(
	DRIVER_ID INT PRIMARY KEY,
    PNAME VARCHAR(20),
    ADDRESS VARCHAR(20)
);

/* CAR TABLE */
CREATE TABLE CAR(
	REG_NO VARCHAR(10) PRIMARY KEY,
    MODEL VARCHAR(10),
    RYEAR INT
);

/* OWNS */
CREATE TABLE OWNS(
	DRIVER_ID INT,
    REG_NO VARCHAR(10),
    FOREIGN KEY(DRIVER_ID) REFERENCES PERSON(DRIVER_ID),
    FOREIGN KEY(REG_NO) REFERENCES CAR(REG_NO)
);

/* ACCIDENT */
CREATE TABLE ACCIDENT(
	REPORT_NO INT PRIMARY KEY,
    ACCIDENT_DATE DATE,
    LOCATION VARCHAR(20)
);

/* PARTICIPATED */
CREATE TABLE PARTICIPATED(
	REPORT_NO INT,
    REG_NO VARCHAR(10),
    DRIVER_ID INT,
    DAMAGE_AMT INT,
    FOREIGN KEY(DRIVER_ID) REFERENCES PERSON(DRIVER_ID),
    FOREIGN KEY(REG_NO) REFERENCES CAR(REG_NO),
    FOREIGN KEY(REPORT_NO) REFERENCES ACCIDENT(REPORT_NO)
);


SELECT * FROM PERSON;
SELECT * FROM CAR;
SELECT * FROM OWNS;
SELECT * FROM ACCIDENT;
SELECT * FROM PARTICIPATED;


/* INSERT DATA - PERSON */
INSERT INTO PERSON VALUES
(0, 'Jenson Button', 'University St'),
(1, 'Rubens Barrichello', '1st Ave'),
(2, 'Sebastian Vettel', '1st Ave'),
(3, 'Mark Webber', '1st Ave'),
(4, 'Lewis Hamilton', '1st Ave'),
(5, 'Felipe Massa', 'University St');

/* INSERT DATA - CAR */
INSERT INTO CAR VALUES
('SZM813','Honda',2009),
('SZM814','Toyota',2009),
('SZM815','BMW',2009),
('SZM816','Honda',2009),
('SZM817','Honda',2008),
('SZM818','BMW',2008),
('SZM819','BMW',2008),
('SZM820','Toyota',2008);

/* INSERT DATA - OWNS */
INSERT INTO OWNS VALUES
(0,'SZM813'),
(1,'SZM814'),
(2,'SZM815'),
(3,'SZM816'),
(4,'SZM817'),
(5,'SZM818'),
(0,'SZM819'),
(4,'SZM820');

/* INSERT DATA - ACCIDENT */
INSERT INTO ACCIDENT VALUES
(1,'2008-04-13','Monza'),
(2,'2008-07-22','Indianapolis'),
(3,'2008-07-22','Indianapolis'),
(4,'2008-07-22','New Work'),
(5,'2008-07-27','New Work'),
(6,'2009-01-27','Highland Heights'),
(7,'2009-02-15','Highland Heights');

/* INSERT DATA - PARTICIPATED */
INSERT INTO PARTICIPATED VALUES
(1, 'SZM813',0,4000),
(2, 'SZM814',1,6000),
(3, 'SZM815',4,6000),
(4, 'SZM814',1,1000),
(5, 'SZM817',4,6000),
(6, 'SZM818',5,5000),
(7, 'SZM819',0,5000),
(4, 'SZM817',4,3000),
(5, 'SZM813',0,4000),
(6, 'SZM814',3,2000),
(7, 'SZM814',1,1000),
(7, 'SZM820',4,6000),
(7, 'SZM813',3,4000);

/*III. Write a SQL quary to update the damage amount for the car with specific registration number in the accident with report number between 1 & 5 */
UPDATE PARTICIPATED
SET DAMAGE_AMT = 11000
WHERE REG_NO = 'SZM814'
AND REPORT_NO BETWEEN 1 AND 5;

SELECT *
FROM PARTICIPATED;

/*IV. Quary to find the total number of people who owned the cars that were involved in accidents in 2008 */
SELECT COUNT(DISTINCT O.DRIVER_ID) AS NUM_OWNERS_OF_INVOLVED_CARS_2008
FROM OWNS O
JOIN PARTICIPATED P ON O.REG_NO = P.REG_NO
JOIN ACCIDENT A ON P.REPORT_NO = A.REPORT_NO
WHERE YEAR(A.ACCIDENT_DATE) = 2008;

/*V. Quary to check if a person with a specific driver_id has met with on accIdent in 2009 */
SELECT A.REPORT_NO, A.ACCIDENT_DATE, A.LOCATION, P.DAMAGE_AMT
FROM PARTICIPATED P
JOIN ACCIDENT A ON P.REPORT_NO = A.REPORT_NO
WHERE DRIVER_ID = 3
AND YEAR(A.ACCIDENT_DATE) = 2009;